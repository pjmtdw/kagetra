- content_for :title do
  管理画面  
- content_for :js_start do
  admin
- content_for :css do
  admin
= haml :top_bar

.row
  .large-12.columns
    %ul.breadcrumbs
      %li
        %a ユーザ編集
      %li
        %a ユーザ追加
      %li
        %a 属性編集
      %li
        %a 設定

#admin-view
  .header
  .body

%script#attr-key-values(type='text/template')
  .row
    .large-6.columns
      %select.attr-key-names
        <% _.each(key_names,function(x){ %>
        %option(value='{-x[0]-}') {- x[1] -}
        <% }) %>
    .large-6.columns
      %select.attr-value-names

%script#templ-admin-header(type='text/template')
  .row
    %form#filter-form
      .row
        .large-2.columns
          %input#filter-text(type='text' placeholder='名前 or ふりがな' autofocus)
        .large-3.columns.left
          .attr-key-values

%script#templ-admin-body(type='text/template')
  .row
    .large-4.columns
      選択:
      %span#selected-count {- _.filter(data,function(x){return x.selected}).length -}
      %button.small.round#clear-select
        選択取消
      %button.small.round#reveal-edit
        一括編集
    .large-4.columns.left
      変更点:
      %span#edit-log-count {- data.edit_log_count -}
      %button.small.round#undo-last-edit
        最後の変更取消
      %button.small.round#apply-edit
        全変更反映
  .row
    %table
      %thead
        %tr(data-uid='-1')
          %th 
          %th.select-user &oplus;
          %th 名前
          %th.thead.thead-furigana ふりがな
          %th.thead.thead-last-login 最終ログイン
          <% _.each(key_names,function(x,index){ %>
          %th.thead.thead-key-name(data-key-index='{{index}}') {- x[1] -}
          <% }) %>
      %tbody
        <% _.each(_.filter(data,function(x){return x.visible}),function(x,i){ %>
        %tr(data-uid='{{x.id}}')
          %td {{ i+1 }}
          %td.select-user(class='{{x.selected?"selected":""}}') &oplus;
          %td.name {- x.name -}
          %td.furigana {- x.furigana -}
          %td {{ x.login_latest }}
          <% _.each(x.attrs,function(a){ %>
          <% av = attr_values[a] %>
          %td.user-attr(data-key-id='{{av.key_id}}' data-value-id='{{a}}') {- av.value -}
          <% }) %>
        <% }) %>

%script#templ-admin-edit(type='text/template')
  編集対象:
  .panel
    <% _.each(data,function(x){ %>
    <% if(x.selected){ %>
    <%- x.name %>
    <% } %>
    <% }) %>
  .row
    .large-6.columns
      %fieldset
        %legend 権限編集
        .row
          .large-7.columns
            %select#permission-name
              %option(value='loginable') ログイン
              %option(value='admin') 管理者
              %option(value='sub_admin') 副管理者
          .large-5.columns
            %button.small.round#add-permission 付与
            %button.small.round#del-permission 解除
    .large-6.columns
      %fieldset
        %legend 属性編集
        .row
          .large-9.columns
            .attr-key-values
          .large-3.columns
            %button.small.round#change-attr 変更
  .row
    .large-6.columns
      %form#change-passwd
        %fieldset
          %legend パスワード変更
          .row
            .large-5.columns
              %label 新パスワード
              %input.pass-new(type='password')
            .large-5.columns
              %label 新パスワード確認
              %input.pass-retype(type='password')
            .large-2.columns
              %input.button.small.round(type='submit' value='変更')
    .large-6.columns
      %form#delete-user
        %fieldset
          %legend ユーザ削除
          %input.button.small.round(type='submit' value='ユーザ削除')


#admin-edit.reveal-modal
  %script
    var g_new_salt="#{@new_salt}";
